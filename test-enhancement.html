<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Enhanced Gemini Integration</title>
    <script src="gemini-integration.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .test-section {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }
        .test-button {
            background: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px;
        }
        .test-button:hover {
            background: #45a049;
        }
        .test-result {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 5px;
            padding: 15px;
            margin: 10px 0;
            white-space: pre-wrap;
        }
        .loading {
            color: #ffd700;
        }
        .success {
            color: #4CAF50;
        }
        .error {
            color: #f44336;
        }
    </style>
</head>
<body>
    <h1>üß™ Enhanced Gemini Integration Test</h1>
    
    <div class="test-section">
        <h2>üîë API Key Setup</h2>
        <input type="text" id="apiKey" placeholder="Enter your Gemini API key" style="width: 100%; padding: 10px; margin: 10px 0; border-radius: 5px; border: none;">
        <button class="test-button" onclick="setApiKey()">Set API Key</button>
        <div id="apiKeyStatus" class="test-result"></div>
    </div>

    <div class="test-section">
        <h2>üìù Code Analysis Test</h2>
        <button class="test-button" onclick="testCodeAnalysis()">Test Enhanced Code Analysis</button>
        <div id="analysisResult" class="test-result"></div>
    </div>

    <div class="test-section">
        <h2>üîß Fixed Code Generation Test</h2>
        <button class="test-button" onclick="testFixedCodeGeneration()">Test Fixed Code Generation</button>
        <div id="fixedCodeResult" class="test-result"></div>
    </div>

    <div class="test-section">
        <h2>üí° Improvement Suggestions Test</h2>
        <button class="test-button" onclick="testImprovementSuggestions()">Test Improvement Suggestions</button>
        <div id="suggestionsResult" class="test-result"></div>
    </div>

    <div class="test-section">
        <h2>üìä All Features Integration Test</h2>
        <button class="test-button" onclick="testAllFeatures()">Test Complete Workflow</button>
        <div id="integrationResult" class="test-result"></div>
    </div>

    <script>
        // Sample test code with various issues
        const testCode = `def calculate_sum(a,b):
    #This function calculates sum
    x=a+b
    return x

def process_data(data):
    result=[]
    for i in data:
        if i>0:
            result.append(i*2)
    return result

# Main execution
numbers=[1,2,3,4,5]
print(calculate_sum(10,20))
print(process_data(numbers))`;

        let geminiAnalyzer;

        function setApiKey() {
            const apiKey = document.getElementById('apiKey').value;
            if (!apiKey) {
                document.getElementById('apiKeyStatus').innerHTML = '<span class="error">‚ùå Please enter an API key</span>';
                return;
            }

            localStorage.setItem('geminiApiKey', apiKey);
            geminiAnalyzer = new GeminiCodeAnalyzer();
            
            document.getElementById('apiKeyStatus').innerHTML = '<span class="success">‚úÖ API key set successfully!</span>';
        }

        async function testCodeAnalysis() {
            if (!geminiAnalyzer) {
                document.getElementById('analysisResult').innerHTML = '<span class="error">‚ùå Please set API key first</span>';
                return;
            }

            document.getElementById('analysisResult').innerHTML = '<span class="loading">‚è≥ Testing enhanced code analysis...</span>';
            
            try {
                const analysis = await geminiAnalyzer.analyzeCode(testCode);
                
                const result = `
‚úÖ Enhanced Code Analysis Test PASSED!

üìä Analysis Results:
‚Ä¢ Overall Score: ${analysis.overallScore}/10
‚Ä¢ Code Quality: ${analysis.codeQuality}
‚Ä¢ Issues Found: ${analysis.issues.length}

üîç Issues Breakdown:
${analysis.issues.map(issue => 
    `‚Ä¢ ${issue.type} (${issue.severity}): ${issue.description}`
).join('\n')}

üìù Explanation:
${analysis.explanation}

üí° Key Improvements:
${analysis.keyImprovements.map(improvement => 
    `‚Ä¢ ${improvement}`
).join('\n')}

üéØ Practice Tasks:
${analysis.practiceTasks.map(task => 
    `‚Ä¢ ${task}`
).join('\n')}

üìö Analogy:
${analysis.analogy}

‚ú® Fixed Code Available: ${analysis.fixedCode ? 'Yes' : 'No'}
                `;
                
                document.getElementById('analysisResult').innerHTML = `<span class="success">${result}</span>`;
                
            } catch (error) {
                document.getElementById('analysisResult').innerHTML = `<span class="error">‚ùå Error: ${error.message}</span>`;
            }
        }

        async function testFixedCodeGeneration() {
            if (!geminiAnalyzer) {
                document.getElementById('fixedCodeResult').innerHTML = '<span class="error">‚ùå Please set API key first</span>';
                return;
            }

            document.getElementById('fixedCodeResult').innerHTML = '<span class="loading">‚è≥ Testing fixed code generation...</span>';
            
            try {
                // First get analysis
                const analysis = await geminiAnalyzer.analyzeCode(testCode);
                
                // Then generate fixed code
                const fixedCode = await geminiAnalyzer.generateFixedCode(testCode, analysis.issues);
                
                const result = `
‚úÖ Fixed Code Generation Test PASSED!

üîß Original Code Issues: ${analysis.issues.length}

‚ú® Generated Fixed Code:
\`\`\`python
${fixedCode}
\`\`\`

üìä Code Quality Improvements:
‚Ä¢ Original Score: ${analysis.overallScore}/10 (${analysis.codeQuality})
‚Ä¢ Expected Improvement: Enhanced readability, PEP8 compliance, better error handling

üéØ Key Fixes Applied:
${analysis.issues.slice(0, 3).map(issue => 
    `‚Ä¢ ${issue.type}: ${issue.description}`
).join('\n')}
                `;
                
                document.getElementById('fixedCodeResult').innerHTML = `<span class="success">${result}</span>`;
                
            } catch (error) {
                document.getElementById('fixedCodeResult').innerHTML = `<span class="error">‚ùå Error: ${error.message}</span>`;
            }
        }

        async function testImprovementSuggestions() {
            if (!geminiAnalyzer) {
                document.getElementById('suggestionsResult').innerHTML = '<span class="error">‚ùå Please set API key first</span>';
                return;
            }

            document.getElementById('suggestionsResult').innerHTML = '<span class="loading">‚è≥ Testing improvement suggestions...</span>';
            
            try {
                // First get analysis
                const analysis = await geminiAnalyzer.analyzeCode(testCode);
                
                // Then generate improvement suggestions
                const suggestions = await geminiAnalyzer.generateImprovementSuggestions(testCode, analysis);
                
                const result = `
‚úÖ Improvement Suggestions Test PASSED!

üéØ Personalized Learning Plan Generated!

üìä Based on Analysis:
‚Ä¢ Overall Score: ${analysis.overallScore}/10
‚Ä¢ Code Quality: ${analysis.codeQuality}
‚Ä¢ Issues Found: ${analysis.issues.length}

üí° AI-Powered Suggestions:
${suggestions}

‚ú® Features Tested:
‚Ä¢ Personalized learning path generation
‚Ä¢ Immediate action items
‚Ä¢ Resource recommendations
‚Ä¢ Practice exercises
‚Ä¢ Pro tips and best practices
                `;
                
                document.getElementById('suggestionsResult').innerHTML = `<span class="success">${result}</span>`;
                
            } catch (error) {
                document.getElementById('suggestionsResult').innerHTML = `<span class="error">‚ùå Error: ${error.message}</span>`;
            }
        }

        async function testAllFeatures() {
            if (!geminiAnalyzer) {
                document.getElementById('integrationResult').innerHTML = '<span class="error">‚ùå Please set API key first</span>';
                return;
            }

            document.getElementById('integrationResult').innerHTML = '<span class="loading">‚è≥ Testing complete workflow...</span>';
            
            try {
                // Step 1: Analyze code
                const analysis = await geminiAnalyzer.analyzeCode(testCode);
                
                // Step 2: Generate fixed code
                const fixedCode = await geminiAnalyzer.generateFixedCode(testCode, analysis.issues);
                
                // Step 3: Generate improvement suggestions
                const suggestions = await geminiAnalyzer.generateImprovementSuggestions(testCode, analysis);
                
                const result = `
‚úÖ COMPLETE WORKFLOW TEST PASSED!

üöÄ Enhanced Gemini Integration Features:

üìä 1. Enhanced Code Analysis
‚Ä¢ Score: ${analysis.overallScore}/10 (${analysis.codeQuality})
‚Ä¢ Issues: ${analysis.issues.length} identified
‚Ä¢ Comprehensive feedback with explanations
‚Ä¢ Practice tasks and analogies

üîß 2. AI-Powered Fixed Code Generation
‚Ä¢ Improved code quality and readability
‚Ä¢ PEP8 compliance
‚Ä¢ Bug fixes and optimizations
‚Ä¢ Enhanced documentation

üí° 3. Personalized Learning Plan
‚Ä¢ Immediate action items
‚Ä¢ Resource recommendations
‚Ä¢ Progressive skill development
‚Ä¢ Practice exercises

üéØ 4. Enhanced User Experience
‚Ä¢ Better error handling
‚Ä¢ Fallback mechanisms
‚Ä¢ Structured feedback
‚Ä¢ Actionable insights

üìà 5. Key Improvements Over Original:
‚Ä¢ More detailed analysis prompts
‚Ä¢ Better JSON parsing and validation
‚Ä¢ Enhanced error handling
‚Ä¢ Additional AI-powered features
‚Ä¢ Improved user feedback
‚Ä¢ Comprehensive learning paths

‚ú® All features working correctly! The enhanced Gemini integration provides a comprehensive code mentorship experience.
                `;
                
                document.getElementById('integrationResult').innerHTML = `<span class="success">${result}</span>`;
                
            } catch (error) {
                document.getElementById('integrationResult').innerHTML = `<span class="error">‚ùå Error: ${error.message}</span>`;
            }
        }

        // Initialize on page load
        window.onload = function() {
            const savedApiKey = localStorage.getItem('geminiApiKey');
            if (savedApiKey && savedApiKey !== 'YOUR_GEMINI_API_KEY_HERE') {
                document.getElementById('apiKey').value = savedApiKey;
                geminiAnalyzer = new GeminiCodeAnalyzer();
                document.getElementById('apiKeyStatus').innerHTML = '<span class="success">‚úÖ API key loaded from storage</span>';
            }
        };
    </script>
</body>
</html>
